server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # --- Podstawowe nagłówki ---
  add_header X-Content-Type-Options nosniff always;
  add_header X-Frame-Options SAMEORIGIN always;
  add_header Referrer-Policy strict-origin-when-cross-origin always;

  # --- Gzip (prosto i bezpiecznie) ---
  gzip on;
  gzip_types
    text/plain
    text/css
    text/javascript
    application/javascript
    application/json
    application/xml
    image/svg+xml;
  gzip_min_length 1024;

  # --- Cache dla wersjonowanych plików Vite (assets/* zwykle ma hashe) ---
  location /assets/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
  }

  # --- (Opcjonalnie) cache dla fontów/ikon ---
  location ~* \.(?:ico|css|js|gif|jpe?g|png|svg|woff2?)$ {
    expires 30d;
    add_header Cache-Control "public";
    try_files $uri =404;
  }

  # --- SPA fallback (React Router) ---
  location / {
    try_files $uri $uri/ /index.html;
  }

  # --- (Opcjonalnie) WebSocket reverse proxy ---
  # Jeśli frontend łączy się np. z /ws/... i chcesz to terminować w Nginx,
  # odkomentuj i ustaw właściwy upstream.
  #
  # location /ws/ {
  #   proxy_http_version 1.1;
  #   proxy_set_header Upgrade $http_upgrade;
  #   proxy_set_header Connection "upgrade";
  #   proxy_set_header Host $host;
  #   proxy_read_timeout 3600;
  #   proxy_pass http://nodered:1880;
  # }
}
